{# Language Switcher - Only shows when multiple languages are enabled #}
{%- set currentLang = lang | default("en") -%}
{%- set currentLangInfo = currentLang | langData -%}
{%- set enabledLangs = enabledLanguages | selectattr("enabled", "equalto", true) | list -%}

{%- if enabledLangs.length > 1 -%}
<div class="lang-switcher">
  <button class="lang-switcher-toggle" aria-expanded="false" aria-haspopup="listbox" aria-label="Select language">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    <span class="lang-current">{{ currentLangInfo.code | upper }}</span>
    <svg class="lang-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </button>
  <ul class="lang-menu" role="listbox" aria-label="Select language">
    {%- for langOption in enabledLangs -%}
    {%- set langUrl = basePath | langUrl(langOption.code) -%}
    <li role="option"{% if langOption.code == currentLang %} aria-selected="true"{% endif %}>
      <a href="{{ langUrl }}" hreflang="{{ langOption.hreflang }}" lang="{{ langOption.code }}">
        <span class="lang-name">{{ langOption.nativeName }}</span>
        <span class="lang-code">{{ langOption.code | upper }}</span>
      </a>
    </li>
    {%- endfor -%}
  </ul>
</div>
{%- endif -%}
